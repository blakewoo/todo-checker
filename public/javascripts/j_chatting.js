window.onload=async function(t){headlineInit();let e="";const n=io();await async function(){return new Promise(((t,n)=>requestFunction("GET","/todo-share/chatlist",{},"JSON",(function(a){if(a.status){let n=document.getElementById("sharedChatSelect");if(0!==a.result.length){e=a.myId;let t=document.createDocumentFragment();for(let n=0;n<a.result.length;n++){let o=document.createElement("option");e===a.result[n].TARGET_USER_ID?o.innerText=a.result[n].OVERSEER_USER_ID:o.innerText=a.result[n].TARGET_USER_ID,t.appendChild(o)}n.append(t)}t(!0)}else n(!0)}))))}(),await async function(){let t=document.getElementById("sharedChatSelect"),n=t.options[t.selectedIndex].text;return new Promise(((t,a)=>requestFunction("GET","/chatting/my?targetId="+n,{},"JSON",(function(n){if(n.status){let a=n.result,o="",l=null;for(let t=0;t<a.length;t++)null===l?(o+=new Intl.DateTimeFormat("ko",{dateStyle:"short"}).format(new Date(a[t].CREATED))+"\n\n\n",l=new Intl.DateTimeFormat("ko",{dateStyle:"short"}).format(new Date(a[t].CREATED))):l!==new Intl.DateTimeFormat("ko",{dateStyle:"short"}).format(new Date(a[t].CREATED))&&(o+="\n\n"+new Intl.DateTimeFormat("ko",{dateStyle:"short"}).format(new Date(a[t].CREATED))+"\n\n\n",l=new Intl.DateTimeFormat("ko",{dateStyle:"short"}).format(new Date(a[t].CREATED))),a[t].REQUEST_ID===e?o+="나 ["+new Intl.DateTimeFormat("ko",{timeStyle:"short"}).format(new Date(a[t].CREATED))+"]  : "+a[t].MESSAGE+"\n":o+=a[t].DESTINATION_ID+" ["+new Intl.DateTimeFormat("ko",{timeStyle:"short"}).format(new Date(a[t].CREATED))+"] :  "+a[t].MESSAGE+"\n";document.getElementById("textDisplayDiv").innerText=o,t(!0)}else a(!0)}))))}(),requestFunction("GET","/user/my",{},"JSON",(function(t){t.status&&n.emit("access",{ID:t.result.ID})})),n.on("chat",(function(t){let e=document.getElementById("sharedChatSelect"),n=e.options[e.selectedIndex].text;document.getElementById("textDisplayDiv").innerText+=n+" ["+new Intl.DateTimeFormat("ko",{timeStyle:"short"}).format(new Date)+"] : "+t+"\n"})),document.getElementById("messageSendButton").addEventListener("click",(function(t){let e=document.getElementById("chattingTextInput").value,a=document.getElementById("sharedChatSelect"),o=a.options[a.selectedIndex].text;requestFunction("POST","/chatting/my",{targetId:o,message:e},"JSON",(function(t){t.status&&(n.emit("chat",{message:e,target:o}),document.getElementById("textDisplayDiv").innerText+="나 ["+new Intl.DateTimeFormat("ko",{timeStyle:"short"}).format(new Date)+"] : "+e+"\n",document.getElementById("chattingTextInput").value="")}))})),document.getElementById("chattingTextInput").addEventListener("keyup",(function(t){"Enter"===t.key&&document.getElementById("messageSendButton").click()}))};